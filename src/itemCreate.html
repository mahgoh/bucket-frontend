<!DOCTYPE html>
<html lang="en">
  <component name="head" />
  <body>
    <div id="app" class="pb-16 sm:pb-0 sm:pt-16">
      <component name="nav" props="-active;;;text-blue-500;;" />
      <component name="pagetitle" props="Create Bucket Item" />
      <component name="form-item-create" />
      <component name="footer" />
      <script>
        ready(function () {
          const watchers = [
            {
              identifier: '#title',
              type: 'text',
              required: true,
              regexp: getRegExp('text', 3, 30),
              message: 'Title must be 3-30 characters long.',
            },
            {
              identifier: '#description',
              type: 'text',
              required: false,
              regexp: getRegExp('text', 0, 128),
              message:
                'Description has a maximum length of 128 characters long.',
            },
            // TODO: Add rule for dateToAccomplish
            // TODO: Add rule for bucket
            // TODO: Replace rule for image
            {
              identifier: '#image',
              type: 'text',
              required: false,
              regexp: getRegExp('url', 0, 1024),
              message: 'Image must be a valid url.',
            },
          ];

          watchValues(watchers, '#submit');

          query('form').addEventListener('submit', (e) => {
            if (formIsValid()) {
              e.preventDefault();

              postBucketItem(
                getBucketItemJSON(
                  null,
                  val('#title'),
                  val('#description'),
                  val('#dateToAccomplish'),
                  val('#image')
                ),
                (result) => {
                  if (validResult(result)) {
                    redirect(`/item/view?id=${result.id}`);
                  } else {
                    // TODO: implement error reporting
                    console.log(result);
                  }
                },
                (error) => {
                  console.error(error);
                  // TODO: implement modal
                  // $('#error-modal').modal('show');
                  // $('#error-text').text(error);
                }
              );
            }
          });
        });
      </script>
    </div>
  </body>
</html>
